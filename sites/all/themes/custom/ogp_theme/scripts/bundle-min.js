"use strict";function getAbsolutePath(){var e=window.location,t=e.pathname.substring(0,e.pathname.lastIndexOf("/")+1);return e.href.substring(0,e.href.length-((e.pathname+e.search+e.hash).length-t.length))}function convertPostDate(e,t){var a=new Date(1e3*e),n=a.getDate(),o=a.getMonth()+1,i=a.getFullYear();return"dd/mm/yyyy"===t&&(n<10&&(n="0"+n),o<10&&(o="0"+o)),a=n+"/"+o+"/"+i}function convertEventDate(e){var t=moment(e,"YYYY-M-DD HH:mm:ss");return t.format("MMMM D, YYYY - hh:mm")}function dateDiff(e){return moment().diff(e,"days")}function smoothScroll(){$('a[href*="#"]:not([href="#"])').click(function(){if(location.pathname.replace(/^\//,"")==this.pathname.replace(/^\//,"")&&location.hostname==this.hostname){var e=$(this.hash);if(e=e.length?e:$("[name="+this.hash.slice(1)+"]"),e.length)return $("html, body").animate({scrollTop:e.offset().top},500),!1}})}function getAuthors(e){var t="";return e[0]&&e.forEach(function(a,n){t+=n===e.length-1?""+a.label:a.label+", "}),t}function stripEmptyStrings(){$("p").each(function(){var e=$(this);0==e.html().replace(/\s|&nbsp;/g,"").length&&e.remove()})}function addDots(e,t){var a="...";return e.length>t&&(e=e.substring(0,t)+a),e}function aboutMenu(){!function(e){e(".parent .icon").click(function(){var t=e(this).data("value");e("#"+t+".sub-menu").toggleClass("-open"),e("#"+t).toggleClass("-open")})}(jQuery)}function closeAccordionSection(){$(".c-accordion .accordion-section-title").removeClass("active"),$(".c-accordion .accordion-section-content").slideUp(200).removeClass("open")}function getPageCount(e,t){return Math.ceil(e/t)}function appendAccordionItems(e,t){var a=$("#"+e+" .c-accordion"),n="";t.forEach(function(t){n+='\n      <div class="accordion-section">\n        <a class="accordion-section-title text -small-bold -black" href="#accordion-'+e+"-"+t.id+'">'+t.label+'<svg class="icon -blue -small"><use xlink:href="#icon-down-arrow"></use></svg></a>\n        <div id="accordion-'+e+"-"+t.id+'" class="accordion-section-content">\n        <div class="text -body-content body-container">'+t.body.value+'</div>\n        <div class="body-container -link">\n          <a class="text -blue link-accordion" href="/'+t.alias+'">See more <svg class="icon -blue -medium"><use xlink:href="#icon-arrow"></use></svg></a>\n        </div>\n        </div>\n      </div>\n    '}),a.html(n)}function setAccordionListeners(e){$("#"+e+" .accordion-section-title").click(function(t){var a=$(this).attr("href");$(t.target).is(".active")?closeAccordionSection():(closeAccordionSection(),$(this).addClass("active"),$("#"+e+" .c-accordion "+a).slideDown(200).addClass("open")),t.preventDefault()})}function initAccordion(e,t){appendAccordionItems(e,t),setAccordionListeners(e)}function addBanner(e,t){switch(e){case"writestory":$(".banners-container").append('\n        <div class="l-full-width -blue -short -center">\n          <div class="row">\n            <div class="column small-12 medium-7 large-9">\n              <h3 class="text -title-small -white">What is your country doing?</h3>\n              <p class="text -white">\n                See how your goverment and civil society are working together to accomplish commitments\n               for the current National Action Plan cycle. Or write your own story.\n              </p>\n            </div>\n            <div class="column small-12 medium-5 large-3 vertical">\n              <a class="c-button -box -large -center" href="/submit-story">write story</a>\n            </div>\n          </div>\n        </div>\n      ');break;case"newsletter":$(".banners-container").append('\n        <div class="l-full-width -black -short -center">\n          <div class="row">\n            <div class="column small-12 medium-7 large-9">\n              <h3 class="text -title-small -white">OGP’s monthly newsletter</h3>\n              <p class="text -white">\n                Helps goverments, civil society actors and concerned citizens stay informed\n              </p>\n            </div>\n            <div class="column small-12 medium-5 large-3 vertical">\n                <span class="c-button -box -large -center js-subscribeModalOpen">Subscribe</span>\n            </div>\n          </div>\n        </div>\n      ');break;case"involved":$(".banners-container").append('\n        <div class="l-full-width -black -short -center">\n          <div class="row">\n            <div class="column small-12 medium-7 large-9">\n              <h3 class="text -title-small -white">Get involved</h3>\n              <p class="text -white">\n                For the Open Government Partnership model to work, lots of people need to get involved\n              </p>\n            </div>\n            <div class="column small-12 medium-5 large-3 vertical">\n                <a class="c-button -box -large -center" href="/resources">Resources</a>\n            </div>\n          </div>\n        </div>\n      ');break;case"peopleCountry":$.getJSON("/apiJSON/countries/"+t,function(e){$(".banners-container").append('\n            <div class="l-full-width -blue -short -center">\n              <div class="row">\n                <div class="column small-12 medium-7 large-9">\n                  <h3 class="text -title-small -white">People involved from '+e.data[0].label+'</h3>\n                  <p class="text -white">\n                    For the Open Government Partnership model to work, lots of people need to get involved\n                  </p>\n                </div>\n                <div class="column small-12 medium-5 large-3 vertical">\n                  <a class="c-button -box -large -center" href="/submit-story">EXPLORE PEOPLE</a>\n                </div>\n              </div>\n            </div>\n          ')})}}function showComments(e){!function(){var e=document,t=e.createElement("script");t.src="//opengovpartnership.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)}()}function buildExploreMoreTiles(e,t,a){var n="";t&&(n="filter["+t+"]="+a+"&"),$.getJSON("/apiJSON/"+e+"?"+n+"page[size]=4",function(e){if(e.data.length){var t=e.data.slice(0,4);appendTiles(t,$(".c-explore-more .container"),4)}removeLoader(".c-explore-more")})}function buildLink(e){var t='\n    <div class="c-link">\n      <div class="link">\n        <svg class="icon -blue"><use xlink:href="#icon-external-link"></use></svg>\n        <a class="text -link -blue" href="/'+e.link.url+'" target="_blank" rel="nofollow">'+e.label+"</a>\n      </div>\n      "+(e.description?'<p class="text -footnote">Description lorem ipsum leo isus, porta ac consectetur ac, vestibulum at eras.</p>':"")+"\n    </div>\n  ";return t}function buildRelLink(e){var t='\n    <div class="c-link">\n      <div class="link">\n        <svg class="icon -blue"><use xlink:href="#icon-external-link"></use></svg>\n        <a class="text -link -blue" href="/'+e.alias+'" rel="nofollow">'+e.label+"</a>\n      </div>\n      "+(e.description?'<p class="text -footnote">Description lorem ipsum leo isus, porta ac consectetur ac, vestibulum at eras.</p>':"")+"\n    </div>\n  ";return t}function removeLoader(e,t,a){a?$(e+" .c-loader").addClass("-hidden"):$(e+" .c-loader").remove(),t&&t.forEach(function(e){$(e).removeClass("-hidden")})}function showLoader(e){$(e+" .c-loader").removeClass("-hidden")}function initModal(e,t,a){var n='\n    <div id="'+e+'" class="c-modal '+a+'">\n      <div class="modal-overlay"></div>\n      <div class="modal-container">\n        <svg class="icon close-icon js-close-modal"><use xlink:href="#icon-close"></use></svg>\n        <div class="modal-content">\n          '+t+"\n        </div>\n      </div>\n    </div>\n  ";$("body").append(n),setModalListeners(e)}function closeModal(e){$("#"+e).removeClass("-open")}function openModal(e){$("#"+e).addClass("-open"),$("body").addClass("-fixed")}function updateModalContainer(e,t){$("#"+e+" .modal-content").html(t)}function setModalListeners(e){$(".js-"+e+"Open").on("click",function(){openModal(e)}),$(".js-close-modal").on("click",function(){closeModal(e)}),$(".modal-overlay").on("click",function(){closeModal(e)}),"subscribeModal"===e&&onChangeNewsletterListener()}function onChangeNewsletterListener(){$(".newsletter-selector").on("click",function(){var e="http://opengovpartnership.us3.list-manage.com/subscribe/post?u=b25f647af089f5f52485a663d&id="+$(this).data("option");$(".newsletter-selector").removeClass("-selected"),$(this).addClass("-selected"),$("#subscribeModal .c-form").attr("target",e)})}function buildSubscribeModal(){var e='\n    <form class="c-form validate" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" action="http://opengovpartnership.us3.list-manage.com/subscribe/post?u=b25f647af089f5f52485a663d&id=874e29c81c" method="POST">\n      <div class="content-wrapper">\n        <h3 class="text -module-title with-padding">Our Newsletters</h3>\n        <label class="text -small-bold -blue" for="email">Email</label>\n        <input type="email" required="required" placeholder="Your email address" id="mce-EMAIL" name="EMAIL">\n        <label class="text -small-bold -blue">Subscribe to</label>\n        <div class="selector-boxes">\n          <div class="text newsletter-selector -selected -interactive" data-option="874e29c81c">OGP Newsletter</div>\n          <div class="text newsletter-selector -interactive" data-option="20323ef712">OGP Gazette</div>\n          <div class="text newsletter-selector -interactive" data-option="ec2455b5b5">Boletín de OGP</div>\n        </div>\n      </div>\n      <input type="submit" name="subscribe" id="mc-embedded-subscribe" class="c-button -tall -green-back -white" value="subscribe">\n    </form>\n  ';initModal("subscribeModal",e,"-subscribe")}function buildMapModal(){var e="";initModal("mapModal",e,"-map")}function updateMapModal(e,t,a){$("#mapModal .modal-content").html(""),setMapModalContent("mapModal",t,e,a)}function setDataToModal(e,t){updateModalContainer(e,t),removeLoader(".l-map",null,!0),openModal(e)}function pushDefaultModal(e,t,a,n,o,i,r,s){$.getJSON("apiJSON/"+t,function(t){var l="",c=[];if("people involved"===n&&s.data.length>0)for(var d=0;d<s.data.length;d+=1)c[d]=s.data[d].id,l+='\n            <a class="text -small-bold -blue" href="'+s.data[d].alias+'">'+s.data[d].label+' (point of contact)</a>\n            <p class="text -body-content">'+addDots(s.data[d].body.value,100)+"</p>\n          ";if(t.data.length>0){var u="slider"===r?t.data.slice(0,3):t.data;u.forEach(function(e){"list"===r?l+='\n            <a href="'+e.alias+'">\n              <h2 class="text -title-x-small">'+e.label+"</h2>\n            </a>\n          ":"grid"===r?$.inArray(e.id,c)===-1&&(l+='\n              <a class="text -small-bold -blue" href="'+e.alias+'">'+e.label+'</a>\n              <p class="text -body-content">'+addDots(e.body.value,100)+"</p>\n            "):"slider"===r&&(l+='\n            <div class="slide -stories">\n              <a href="'+(e.topic[0]?e.topic[0].alias:"")+'" class="text -small-bold -blue">'+(e.topic[0]?e.topic[0].label:"")+'</a>\n              <a href="/'+e.alias+'" class="text -section-title-small">'+e.label+'</a>\n              <span class="text date-text -small-bold">'+moment.unix(e.created).format("D MMMM YYYY")+'</span>\n              <p class="text -meta">'+(e.author[0]?e.author[0].label:"")+"</p>\n            </div>\n          ")})}if("starred-tab"===n){var m='\n        <div class="modal-header">\n          <div class="header-info">\n            <h3 class="text -module-title">'+a.data[0].label+'</h3>\n            <p class="text -meta">Member since '+moment.unix(a.data[0].memberSince).format("YYYY")+", Action plan "+a.data[0].action_plan_count+'</p>\n          </div>\n          <div class="c-data-number">\n            <h3 class="text -number">'+t.count+'</h3>\n            <p class="text -small-bold">'+n+'</p>\n          </div>\n        </div>\n        <div class="content-wrapper -scroll '+("slider"===r?"stories-slider":"")+'">\n          '+l+'\n        </div>\n        <div class="button-container -fixed">\n          <a href="/'+i+'" class="c-button -tall -green-back -box">'+o+'</a>\n          <a href="'+a.data[0].alias+'" class="c-button -tall -green-back -box">VIEW COUNTRY</a>\n        </div>\n      ';setDataToModal(e,m),removeLoader("body",null,!0)}else{var p='\n        <div class="modal-header">\n          <div class="header-info">\n            <h3 class="text -module-title">'+a[0].label+'</h3>\n            <p class="text -meta">Member since '+moment.unix(a[0].memberSince).format("YYYY")+", Action plan "+a[0].action_plan_count+'</p>\n          </div>\n          <div class="c-data-number">\n            <h3 class="text -number">'+t.count+'</h3>\n            <p class="text -small-bold">'+n+'</p>\n          </div>\n        </div>\n        <div class="content-wrapper -scroll '+("slider"===r?"stories-slider":"")+'">\n          '+l+'\n        </div>\n        <div class="button-container -fixed">\n          <a href="/'+i+'" class="c-button -tall -green-back -box">'+o+'</a>\n          <a href="'+a[0].alias+'" class="c-button -tall -green-back -box">VIEW COUNTRY</a>\n        </div>\n      ';setDataToModal(e,p)}})}function pushTabStarredModal(e,t){}function pushSmallModal(e,t,a,n,o,i,r){$.getJSON("apiJSON/"+t,function(t){var s='\n      <div class="content-wrapper">\n        <h3 class="text -module-title">'+a[0].label+'</h3>\n        <p class="text -meta">Member since '+moment.unix(a[0].memberSince).format("YYYY")+'</p>\n        <div class="data-container">\n          <div class="c-data-number -with-padding">\n            <h4 class="text -number">'+t.count+'</h4>\n            <span class="text -small-bold">'+n+'</span>\n          </div>\n          <div class="c-data-number -with-padding">\n            <h4 class="text -number">3</h4>\n            <span class="text -small-bold">'+o+'</span>\n          </div>\n        </div>\n      </div>\n      <div class="button-container">\n        <a class="c-button -box -tall -green-back -white" href="'+r+'">'+i+'</a>\n        <a class="c-button -box -tall -green-back -white" href="'+a[0].alias+'">View country</a>\n      </div>\n    ';setDataToModal(e,s)})}function setMapModalContent(e,t,a,n){var o="theme";if("starred-tab"===t)pushTabStarredModal(e,a),pushDefaultModal(e,"starredcommitments?filter[country]="+a,n,"starred-tab","latest stories","/stories","list","");else{var i=n.filter(function(e){return e.id==a});switch(t){case"actionPlan":pushSmallModal(e,"irm_commitments?filter[country]="+a,i,"commitments","themes covered","latest stories","stories","");break;case"starred":pushDefaultModal(e,"starredcommitments?filter[country]="+a,i,"starred commitments","latest stories","stories","list","");break;case"event":pushDefaultModal(e,"events?filter[country]="+a,i,"events","go to events","news-and-events","list","");break;case"commitment":$(".select-legend-dropdown").find(":selected").data("value")&&(o=$(".select-legend-dropdown").find(":selected").data("value"));var r=$(".select-legend-dropdown").val()?"&filter[theme_id]="+$(".select-legend-dropdown").val():"";pushDefaultModal(e,"current_commitment?filter[country]="+a+r,i,"current commitments","explore this theme",""+o,"list","");break;case"people":$.getJSON("apiJSON/people?filter[country_poc]="+a,function(t){pushDefaultModal(e,"people?filter[country]="+a,i,"people involved","latest stories","stories","grid",t)});break;case"stories":pushDefaultModal(e,"stories?filter[country]="+a,i,"stories","latest stories","stories","slider","")}}}function buildPagination(e,t){var a="";e>1&&(a+='<li class="prev text -pagination onClickPagination" data-value="'+(e-1)+'">back</li>');for(var n=e-4;n<e;n+=1)n<1||(n===e-4&&n>=2?(a+='<li class="text -pagination onClickPagination" data-value="1">1</li>',a+='<li class="text -pagination onClickPagination" data-value="'+n+'">…</li>'):n<=t&&n<e&&(a+='<li class="text -pagination onClickPagination" data-value="'+n+'">'+n+"</li>"));for(var o=e;o<e+5;o+=1)if(o<=t){if(o===e){a+='<li class="-selected text -pagination onClickPagination" data-value="'+o+'">'+o+"</li>";continue}o<e+4&&(a+='<li class="text -pagination onClickPagination" data-value="'+o+'">'+o+"</li>"),o===e+4&&(a+='<li class="text -pagination onClickPagination" data-value="'+o+'">…</li>',a+='<li class="text -pagination onClickPagination" data-value="'+t+'">'+t+"</li>")}return e<t&&(a+='<li class="next text -pagination onClickPagination" data-value="'+(e+1)+'">next</li>'),a}function initPagination(e,t,a){var n=$("#"+a+" .c-pagination");if(t>1){var o=buildPagination(e,t);n.html(o)}else n.html("")}function showNoResults(e,t,a,n,o,i){var r='\n    <div class="c-no-results -'+a+' column small-12">\n      <svg class="icon -'+o+'"><use xlink:href="#icon-compass-'+i+'"></use></svg>\n      <p class="text -'+n+'">'+t+"</p>\n    </div>\n  ";$(e).html(r)}function hideNoResults(e){$(e+" .c-no-results").remove()}function setSearchPlaceholder(e,t){e.attr("placeholder","Search "+t.toLowerCase()+"...")}function setSearchListeners(){$(".c-search-bar input").keyup(function(){var e=$("#themesTiles .c-tabs .-selected").data("node"),t=$(this).val();t=t.toLowerCase(),$(".c-tile").each(function(){e?$(".tile",this).html().toLowerCase().indexOf(t)!==-1&&$(this).data("group")===e?$(this).css("display","block"):$(this).css("display","none"):$(".tile",this).html().toLowerCase().indexOf(t)!==-1?$(this).css("display","block"):$(this).css("display","none")});var a=$(".c-tile").filter(function(){return"block"===$(this).css("display")}).length;0===a?showNoResults("#noResultsContainer","No resources available","tall","grey","xxlarge","blue"):hideNoResults("#noResultsContainer")})}function appendSelectOptions(e,t){t.forEach(function(a){var n='\n      <option value="'+a+'" data-id='+t.id+">"+a+"</option>\n    ";$(e).append(n)})}function appendSelectOptionsFromData(e,t){t.forEach(function(t){var a='\n      <option value="'+t.id+'" data-value="'+t.alias+'">'+t.label+"</option>\n    ";$(e).append(a)})}function getSelectOptionsFromData(e,t,a){var n=[];return e.forEach(function(e){if(e.type&&a.some(function(t){return e.type.indexOf(t)>=0})&&e.date){var t=void 0,o=void 0;t=moment(e.date.value).year(),n.indexOf(t)===-1&&n.push(t),e.date.value2&&(o=moment(e.date.value2).year(),n.indexOf(o)===-1&&n.push(o))}}),n.sort(),n.reverse(),n}function buildSelector(e,t){appendSelectOptions(e,t)}function createTable(e,t){var a="",n=$(".container-info-table"),o=e.data.length;switch(t){case"pages":for(var i=0;i<o;i+=1)e.data[i].body&&(a+='\n            <tr class="text">\n              <th class="text -small-bold">'+e.data[i].label+'</th>\n              <th class="text">'+e.data[i].page_category.label+'</th>\n              <th class="text -blue -capitalize">'+moment.unix(e.data[i].date).startOf("month").fromNow()+'</th>\n              <th><a class="text -blue -capitalize" href="'+e.data[i].alias+'">Go to Page <svg class="icon -blue -medium"><use xlink:href="#icon-arrow"></use></svg></a></th>\n            </tr>\n          ');break;case"groups":for(var r=0;r<o;r+=1)a+='\n          <tr class="text">\n            <th class="text -small-bold">'+e.data[r].label+'</th>\n            <th class="text -body">\n              '+addDots(e.data[r].body.value,120)+'\n            </th>\n            <th class="text">'+e.data[r].name.name+'</th>\n            <th class="text -blue -capitalize">'+moment.unix(e.data[r].date).startOf("month").fromNow()+'</th>\n            <th><a class="text -blue -capitalize" href="'+e.data[r].alias+'">Go to Working Group <svg class="icon -blue -medium"><use xlink:href="#icon-arrow"></use></svg></a></th>\n          </tr>\n        '}n.html(a)}function setTabListeners(e){$(".tab").click(function(t){if(!$(t.target).hasClass("-selected")){var a=t.target.dataset.node,n=t.target.innerHTML;$(".tab").removeClass("-selected"),$(t.target).addClass("-selected"),e(a,n)}})}function initTabs(){$(".tab").first().addClass("-selected")}function buildTabs(e,t,a){e.forEach(function(e){var a='\n      <li class="tab text -tab" data-node="'+e.id+'">'+e.label+"</li>\n    ";t.append(a)}),initTabs(),setTabListeners(a)}function appendTilesWithoutBackground(e,t,a,n){var o=12/a;0!==e.length&&e.forEach(function(e){var a='\n        <div class="column small-12 medium-'+o+" c-tile "+(n?n:"")+'" data-group="'+(e.group?e.group:"")+'">\n          <a href="/'+e.alias+'" class="tile">\n            <span class="text -tile -white">\n              '+e.label+"\n            </span>\n          </a>\n        </div>\n      ";t.append(a)})}function appendTiles(e,t,a,n){var o=12/a;0!==e.length&&e.forEach(function(e){var a='\n        <div class="column small-12 medium-'+o+" c-tile "+(n?n:"")+'" data-group="'+(e.group?e.group:"")+'">\n          <a href="/'+e.alias+'" class="tile" style="background-image: url(\''+(e.image?e.image:"")+'\')">\n            <div class="'+(e.image?"overlay":"")+'"></div>\n            <span class="text -tile -white">\n              '+e.label+"\n            </span>\n          </a>\n        </div>\n      ";t.append(a)})}function appendTilesStandards(e,t,a,n){var o=12/a;0!==e.length&&e.forEach(function(e){var a='\n        <div class="column small-12 medium-4 large-'+o+" c-tile "+(n?n:"")+'" data-group="'+(e.group?e.group:"")+'">\n          <a href="" class="tile" style="background-image: url(\''+(e.image?e.image:"")+'\')">\n            <div class="'+(e.image?"overlay":"")+'"></div>\n            <span class="text -tile -white">\n              '+e+"\n            </span>\n          </a>\n        </div>\n      ";t.append(a)})}function appendSmallTiles(e,t,a,n){var o=$(t+" .data-tiles"),i=12/a;e.length>0&&e.forEach(function(e){var t='\n        <div class="column small-12 large-'+i+" c-tile "+(n?n:"")+'" data-group="'+(e.group?e.group:"")+'">\n          <a href="/'+e.alias+'" class="tile" style="background-image: url(\''+(e.image?e.image:"")+'\')">\n            <div class="'+(e.image?"overlay":"")+'"></div>\n            <span class="text -tile -white">\n              '+e.label+"\n            </span>\n          </a>\n        </div>\n      ";o.append(t)})}function appendTilesIRM(e,t){var a="";e.forEach(function(e){a+='\n      <div class="column small-12 medium-6">\n        <div class="c-country-tile" id="country-report-'+e.id+'">\n          <a class="text -title-x-small" href="'+e.alias+'">'+e.label+'<svg class="icon -blue -medium arrow"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-arrow"></use></svg></a>\n          <div class="row data-tiles">\n    ';var t=e.irm_reports.splice(0,2);t.forEach(function(e){e.type&&(a+='\n        <div class="column small-12 large-6 c-tile -short">\n          <a href="'+e.alias+'" class="tile">\n            <span class="text -tile -white">'+e.label+"</span>\n          </a>\n        </div>\n        ")}),a+="</div></div></div>"}),removeLoader("#tab-loader",null,!0),$(""+t.selector).append(a)}function appendTilesComments(e,t){var a="";e.forEach(function(e){a+='\n      <div class="column small-12 medium-6">\n        <div class="c-country-tile" id="country-comment-'+e.id+'">\n          <a class="text -title-x-small" href="'+e.alias+'">'+e.label+'<svg class="icon -blue -medium arrow"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-arrow"></use></svg></a>\n          <div class="row data-tiles">\n    ';var t=e.irm_report_comments.splice(0,2);t.forEach(function(e){e.type&&(a+='\n          <div class="column small-12 large-6 c-tile -short">\n            <a href="'+e.alias+'" class="tile">\n              <span class="text -tile -white">'+e.label+"</span>\n            </a>\n          </div>\n        ")}),a+="</div></div></div>"}),$(""+t.selector).append(a)}function appendTilesEvent(e,t){if(e.length>0){var a="";e.forEach(function(e){a+='\n        <div class="small-12 medium-3 event-tile-container">\n          <div>\n            <h3 class="text -title-x-small">'+moment(e.date.value).format("MMMM, DD")+'</h3>\n            <span class="text language-text">Language: '+(e.language?e.language:"not specified")+'</span>\n          </div>\n          <div>\n            <a class="text -interactive -blue" href="'+e.alias+'">'+e.label+"</a>\n          </div>\n        </div>\n      "}),t.html(a)}}function appendTilesDetailed(e,t,a){var n=12/a,o="",i=5;e.forEach(function(e){var t="",a="";if(e.topic[0])for(var r=0;r<e.topic.length&&r<=i;r+=1)t+=r===i?'<a href="#" class="disabled">...</a>':r===e.topic.length-1?'<a href="/'+e.topic[r].alias+'">'+e.topic[r].label+"</a>":'<a href="/'+e.topic[r].alias+'">'+e.topic[r].label+", </a>";e.author[0]&&e.author.forEach(function(t,n){a+=n===e.author.length-1?'<a class="text -blue" href="/'+t.alias+'">'+t.label+"</a>":'<a class="text -blue" href="/'+t.alias+'">'+t.label+", </a>"}),o+='\n      <div class="column small-12 medium-'+n+' c-tile">\n        <div class="tile-detailed" style="background-image: url(\''+(e.image?e.image:"")+'\')">\n          <div class="'+(e.image?"overlay":"")+'"></div>\n          <div class="tile-content">\n            <div class="topics text -dynamic-link '+(e.image?"-white":"")+'">'+t+'</div>\n            <a href="/'+e.alias+'"><h3 class="text -tile-detail '+(e.image?"-white":"")+'">'+(e.title?e.title:"")+'</h3></a>\n            <div class="meta">\n              <span class="text -meta-large '+(e.image?"-white":"")+'">'+moment.unix(parseInt(e.created)).format("D MMMM YYYY")+'</span>\n              <a class="text -meta-large '+(e.image?"-white":"")+'">'+a+"</a>\n            </div>\n          </div>\n        </div>\n      </div>\n    "}),t.html(o)}function appendTilesDetailedNews(e,t,a){var n="";e.forEach(function(e){n+='\n      <div class="column small-12 medium-6 c-tile">\n        <div class="tile-detailed">\n          <div></div>\n          <span class="text -uppercase -blue -small-bold">News</span>\n          <div class="tile-content">\n            <a href="/'+e.alias+'"><h3 class="text -tile-detail ">'+(e.label?e.label:"")+'</h3></a>\n            <div class="meta">\n              <span class="text -meta-large">'+moment.unix(parseInt(e.date)).format("DD MMMM YYYY ")+'</span>\n              <span class="text -meta-large">'+e.name.name+"</span>\n            </div>\n          </div>\n        </div>\n      </div>\n    "}),t.html(n)}function appendCountriesInfoBars(e,t){var a=$(t+" .data-tiles"),n="";n='\n    <div class="column small-12">\n      <div class="c-country-info-bar">\n        <strong>Action Plan '+e.year_action_plan+' Potential Impact</strong>\n        <div class="'+(null===e.year_action_plan?"contain-legend-bars -hiden":"contain-legend-bars -show")+'">\n          <span class="box box-none"><div class="box-color"></div>None</span>\n          <span class="box box-minor"><div class="box-color"></div>Minor</span>\n          <span class="box box-moderate"><div class="box-color"></div>Moderate</span>\n          <span class="box box-transformative"><div class="box-color"></div>Transformative</span>\n        </div>\n        <div class="'+(null===e.year_action_plan?"contain-bars-potential -hiden":"contain-bars-potential -show")+'">\n          <div class="bar '+(e.none_impact?"none-bar":"-hiden")+'" style="flex-basis:'+e.none_impact+'%"><span>'+e.none_impact+'%</span></div>\n          <div class="bar '+(e.minor_impact?"minor-bar":"-hiden")+'" style="flex-basis:'+e.minor_impact+'%"><span>'+e.minor_impact+'%</span></div>\n          <div class="bar '+(e.moderate_impact?"moderate-bar":"-hiden")+'" style="flex-basis:'+e.moderate_impact+'%"><span>'+e.moderate_impact+'%</span></div>\n          <div class="bar '+(e.transformative_impact?"transformative-bar":"-hiden")+'" style="flex-basis:'+e.transformative_impact+'%"><span>'+e.transformative_impact+'%</span></div>\n        </div>\n        <div class="message-error '+(null===e.year_action_plan?"-show":"-hiden")+'">\n          <span>Sorry, nothing to see</span>\n        </div>\n        <a href="http://www.opengovpartnership.org/explorer/all-data.html" target="_blank" class="text -blue">For data definitions and more data, see the OGP Explorer</a>\n      </div>\n    </div>\n  ',a.html(n)}function appendCountriesRelevance(e,t){var a=$(t+" .data-tiles"),n=void 0;n='\n    <div class="column small-12">\n      <div class="c-country-relevance-bar">\n        <div class="relevance-bar">\n          <h4>Access to Information '+(e.access_information?"("+e.access_information+"% )":"")+'</h4>\n          <div class="'+(e.access_information?"bar-border":"bar-border -hiden")+'">\n            <div class="'+(e.access_information?"bar":"bar -hiden")+'" style="'+(e.access_information?"width:"+e.access_information+"%":"")+'" >\n              <span class="'+(e.access_information?"bar-error -hiden":"bar-error")+'">Sorry, nothing to see.</span>\n            </div>\n          </div>\n          <h4>Civic Participation '+(e.civic_participation?"("+e.civic_participation+"% )":"")+'</h4>\n          <div class="'+(e.civic_participation?"bar-border":"bar-border -hiden")+'">\n            <div class="'+(e.civic_participation?"bar":"bar -hiden")+'" style="'+(e.civic_participation?"width:"+e.civic_participation+"%":"")+'" >\n              <span class="'+(e.civic_participation?"bar-error -hiden":"bar-error")+'">Sorry, nothing to see.</span>\n            </div>\n          </div>\n          <h4>Public Accountability '+(e.public_accountability?"("+e.public_accountability+"% )":"")+'</h4>\n          <div class="'+(e.public_accountability?"bar-border":"bar-border -hiden")+'">\n            <div class="'+(e.public_accountability?"bar":"bar -hiden")+'" style="'+(e.public_accountability?"width:"+e.public_accountability+"%":"")+'" >\n              <span class="'+(e.public_accountability?"bar-error -hiden":"bar-error")+'">Sorry, nothing to see.</span>\n            </div>\n          </div>\n          <h4>Unclear '+(e.unclear?"("+e.unclear+"% )":"")+'</h4>\n          <div class="'+(e.unclear?"bar-border":"bar-border -hiden")+'">\n            <div class="'+(e.unclear?"bar":"bar -hiden")+'" style="'+(e.unclear?"width:"+e.unclear+"%":"")+'" >\n              <span class="'+(e.unclear?"bar-error -hiden":"bar-error")+'">Sorry, nothing to see.</span>\n            </div>\n          </div>\n        </div>\n        <a href="http://www.opengovpartnership.org/explorer/all-data.html" target="_blank" class="text -blue">For data definitions and more data, see the OGP Explorer</a>\n      </div>\n    </div>\n  ',a.html(n)}function appendCountriesThematicBars(e,t){var a=$(t+" .data-tiles"),n='\n    <div class="column small-12">\n      <div class="c-country-thematic-bar">\n        <div class="thematic-bar">\n        <div class="thematic-bar">\n          <h4>'+e.current_themes[0]+" "+(e.current_percentage.length>0?"("+e.current_percentage[0]+"%)":"")+'</h4>\n          <div class="'+(e.current_percentage[0]?"bar-border":"bar-border -hiden")+'">\n            <div class="'+(e.current_percentage[0]?"bar -green":"bar -hiden")+'" style="'+(e.current_percentage[0]?"width:"+e.current_percentage[0]+"%":"")+'" >\n              <span class="'+(e.current_percentage[0]?"bar-error -hiden":"bar-error")+'">Sorry, nothing to see.</span>\n            </div>\n          </div>\n          <h4>'+e.current_themes[1]+" "+(e.current_percentage[1]?"("+e.current_percentage[1]+"%)":"")+'</h4>\n          <div class="'+(e.current_percentage[1]?"bar-border":"bar-border -hiden")+'">\n            <div class="'+(e.current_percentage[1]?"bar -green":"bar -hiden")+'" style="'+(e.current_percentage[1]?"width:"+e.current_percentage[1]+"%":"")+'" >\n              <span class="'+(e.current_percentage[1]?"bar-error -hiden":"bar-error")+'">Sorry, nothing to see.</span>\n            </div>\n          </div>\n          <h4>'+e.current_themes[2]+" "+(e.current_percentage[2]?"("+e.current_percentage[2]+"%)":"")+'</h4>\n          <div class="'+(e.current_percentage[2]?"bar-border":"bar-border -hiden")+'">\n            <div class="'+(e.current_percentage[2]?"bar -green":"bar -hiden")+'" style="'+(e.current_percentage[2]?"width:"+e.current_percentage[2]+"%":"")+'" >\n              <span class="'+(e.current_percentage[2]?"bar-error -hiden":"bar-error")+'">Sorry, nothing to see.</span>\n            </div>\n          </div>\n        </div>\n        </div>\n        <a href="http://www.opengovpartnership.org/explorer/all-data.html" target="_blank" class="text -blue">For data definitions and more data, see the OGP Explorer</a>\n      </div>\n    </div>\n  ';
a.html(n)}function showCurrentCommitmentDetail(e){!function(t){function a(){t.getJSON("/apiJSON/current_commitment/"+e,function(e){e.data[0].lead_institution[0]&&t("#currentCommitmentContent .lead").html(e.data[0].lead_institution[0]),e.data[0].support_institution[0]&&t("#currentCommitmentContent .support").html(e.data[0].support_institution[0])})}t("#theme-menu").addClass("active"),a(),buildExploreMoreTiles("current_commitment")}(jQuery)}function showIrmCommitmentDetail(e){!function(e){e("#theme-menu").addClass("active"),buildExploreMoreTiles("irm_commitments")}(jQuery)}function showModelCommitmentDetail(e){!function(t){function a(){t.getJSON("/apiJSON/modelcommitments/"+e,function(e){t(".strength-info").html("<strong>Strength: </strong>"+e.data[0].strength.label),t(".contributor-info").html("<strong>Contributors: </strong>"+e.data[0].contributors),t("#justification .container").html(e.data[0].justification),appendTilesStandards(e.data[0].standardsguidance,t("#standards .container"),2),removeLoader(".l-section",null,!0)})}var n=function(e,a){t(".tab-container").addClass("-hidden"),t("#"+e+" .tab-container").removeClass("-hidden")};initTabs(),setTabListeners(n),a(),buildExploreMoreTiles("modelcommitments")}(jQuery)}function showStarredCommitmentDetail(e){!function(e){e("#theme-menu").addClass("active"),buildExploreMoreTiles("starredcommitments")}(jQuery)}function showCountriesDetail(e){!function(t){function a(e,a){t(e).html(""+a)}function n(e,a){var n=t(e);a.forEach(function(e){if(e.value){var t='\n          <div class="c-loading-bar">\n          <div class="text -small-bold -white">'+e.value+"% "+e.theme+'</div>\n          <div class="bar -white" style="width: '+e.value+'%;"></div>\n          </div>\n          ';n.append(t)}})}function o(e,a){var n=t(e);a.forEach(function(e){var t='\n          <li class="story-item">\n            <div class="badge">\n              <svg class="icon -white"><use xlink:href="#icon-external-link"></use></svg>\n            </div>\n            <div class="notification">\n              A new OGP <b>Story</b> has been posted: <b><a href="/'+e.alias+'">'+e.label+"</a></b>\n            </div>\n          </li>\n        ";n.append(t)})}function i(e,a,n,o){var i=t(n).val(),r=t(e+" .links-container"),s="";a.forEach(function(e){e.type&&o.some(function(t){return e.type.indexOf(t)>=0})&&(e.date&&moment(e.date.value).year()===parseInt(i)||e.date&&moment(e.date.value2).year()===parseInt(i))&&(s+=buildRelLink(e))}),""===s?showNoResults(r,"No documents available","short","grey","xlarge","grey"):r.html(s)}function r(e){e.image&&t(g+" .banner-image").css("background-image","url("+e.image+")"),t(g+" .banner-title").html(e.label);var a="";if(a+=convertEventDate(e.date.value),e.date.value2){var n=convertEventDate(e.date.value2);a+=" to "+n+"."}a+=" | "+e.location.locality+", "+e.location.country,t(g+" .banner-date").html(a),t(g+" .c-button").attr("href","/"+e.alias)}function s(a,n,o){t("#"+a+" .onClickPagination").on("click",function(i){var r=t(this).data("value");showLoader("#"+a),t.getJSON("/apiJSON/"+n+"?filter[country]="+e+"&page[number]="+r+"&page[size]="+m+"&sort=label",function(e){initAccordion(a,e.data),initPagination(r,o,a),s(a,n,o),removeLoader("#"+a,null,!0)})})}function l(e,a,n,o){i(e,n,a,o),t(a).on("change",function(){i(e,n,a,o)})}function c(e,a,n,o){if(e.length){var r=getSelectOptionsFromData(e,n,o);r.length?(t(a+" select").removeClass("-hidden"),buildSelector(a+" select",r),l(""+a,a+" select",e,o),t(a+" .select2-selection").removeClass("-hidden")):i(""+a,e,a+" select",o)}}function d(){t(".js-view-more").on("click",function(){t(".body-view-more").toggleClass("-show"),t(this).toggleClass("-open"),t(this).hasClass("-open")?t("span",this).html("VIEW LESS"):t("span",this).html("VIEW MORE")})}var u={actionPlans:["2703"],letters:["2779"],reports:["2704","2768","2705"]},m=10,p="#actionPlansLinks",h="#reportsLinks",v="#lettersLinks",g="#eventsBanner",f=".themes-container",b=".completion-container",w=1,y=0,x=0;t("select").select2({minimumResultsForSearch:1/0,containerCssClass:"-hidden"}),t.getJSON("/apiJSON/countries?filter[id]="+e,function(e){if(e.data){var t=e.data[0];if(a(".c-commitment-count .content-count",t.current_commitments_count),a(".irm-count",t.irm_commitments_count),a(".starred-count",t.starred_commitments_count),a("#currentCommitmentsAccordion .content-count",t.current_commitments_count),a("#irmReviewedCommitmentsAccordion .content-count",t.irm_commitments_count),t.current_themes){for(var o=[],i=0;i<t.current_themes.length;i++)o.push({theme:t.current_themes[i],value:t.current_percentage[i]});n(f,o)}if(t.midterm_percentage||t.endofterm_percentage){var r=[{theme:"Mid term percentage",value:t.midterm_percentage},{theme:"End of term percentage",value:t.endofterm_percentage}];n(b,r)}else showNoResults(".completion-container","Not yet reviewed","short","white","xlarge","grey")}removeLoader("#countryHeaderBanner",null,!0)}),t.getJSON("/apiJSON/current_commitment?filter[country]="+e+"&sort=label&page[size]="+m+"&page[number]=1",function(e){e.data.length?(initAccordion("currentCommitmentsAccordion",e.data),e.count>m&&(y=getPageCount(e.count,m),initPagination(w,y,"currentCommitmentsAccordion"),s("currentCommitmentsAccordion","current_commitment",y))):showNoResults("#currentCommitmentsAccordion .c-accordion","No current commitments","medium","grey","xxlarge","blue"),removeLoader("#currentCommitmentsAccordion",null,!0)}),t.getJSON("/apiJSON/irm_commitments?filter[country]="+e+"&page[size]="+m+"&sort=label&page[number]=1",function(e){e.data.length?(initAccordion("irmReviewedCommitmentsAccordion",e.data),e.count>m&&(x=getPageCount(e.count,m),initPagination(w,x,"irmReviewedCommitmentsAccordion"),s("irmReviewedCommitmentsAccordion","irm_commitments",x))):showNoResults("#irmReviewedCommitmentsAccordion .c-accordion","No reviewed commitments","medium","grey","xxlarge","blue"),removeLoader("#irmReviewedCommitmentsAccordion",null,!0)}),t.getJSON("/apiJSON/stories?filter[country]="+e+"&page[size]=9&sort=-created",function(e){e.data.length?(o(".c-activity-stream ul",e.data),t(".item-bridge").removeClass("-hidden")):showNoResults(".c-activity-stream ul","No recent activity","medium","white","xlarge","grey"),removeLoader(".c-activity-stream")}),t.getJSON("/apiJSON/events?filter[country]="+e,function(e){e.data.length&&dateDiff(e.data[0].date.value)<=0&&(r(e.data[0]),t(g).removeClass("-hidden"))}),t.getJSON("/apiJSON/documents?filter[country]="+e,function(e){var t=e.data;c(t,p,["date"],u.actionPlans),c(t,h,["date"],u.reports),c(t,v,["date"],u.letters),removeLoader("#resourceDocsContainer",null,!0)}),d()}(jQuery)}function initCountriesMap(){var e=L.map("countriesMap",{zoomControl:!1,center:[35,-60],zoom:2,maxZoom:6,minZoom:2,scrollWheelZoom:!1});L.tileLayer("http://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png",{attribution:""}).addTo(e);return $("#in").click(function(){e.setZoom(e.getZoom()+1)}),$("#out").click(function(){e.setZoom(e.getZoom()-1)}),e}function initMapLayer(e,t,a,n){var o=!1;cartodb.createLayer(e,{user_name:"jmonaco",type:"cartodb",sublayers:[]}).addTo(e).done(function(e){e.setInteraction(!0),e.createSubLayer(a.action);var i=[];e.bind("featureOver",function(e,t,a,n,o){i[o]=1,_.any(i)&&$("#countriesMap").css("cursor","pointer")}),e.bind("featureOut",function(e,t){i[t]=0,_.any(i)||$("#countriesMap").css("cursor","auto")}),e.on("featureClick",function(a,o,i,r){switch($(".tooltip").remove(),"participants"!==e.layers[0].options.name&&showLoader(".l-map"),e.layers[0].options.name){case"action":$.getJSON(n+" SELECT * FROM countries_homepage WHERE cartodb_id = "+r.cartodb_id,function(e){updateMapModal(e.rows[0].nid,"actionPlan",t)});break;case"starred":$.getJSON(n+" SELECT * FROM starred_commitments WHERE cartodb_id = "+r.cartodb_id,function(e){updateMapModal(e.rows[0].countryid,"starred",t)});break;case"people":$.getJSON(n+" SELECT * FROM people_involved WHERE cartodb_id = "+r.cartodb_id,function(e){updateMapModal(e.rows[0].countryid,"people",t)});break;case"stories":$.getJSON(n+" SELECT * FROM stories WHERE cartodb_id = "+r.cartodb_id,function(e){updateMapModal(e.rows[0].countryid,"stories",t)});break;case"event":$.getJSON(n+" SELECT * FROM events_country WHERE cartodb_id = "+r.cartodb_id+" AND country IS NOT NULL",function(e){updateMapModal(e.rows[0].countryid,"event",t)});break;case"commitment":$.getJSON(n+" SELECT * FROM currentcommitments_countries WHERE cartodb_id = "+r.cartodb_id,function(e){updateMapModal(e.rows[0].countryid,"commitment",t)});break;case"participants":$.getJSON(n+" SELECT * FROM working_group WHERE cartodb_id = "+r.cartodb_id,function(e){document.location.href=""+window.location.origin+e.rows[0].path})}}),e.on("featureOver",function(e,t,a,n){var i=n.country,r=n.title;o===!1?(i&&$("body").append('<div class="tooltip" style="padding: 5px; position: absolute; z-index: 10; background-color: rgba(255, 255, 255, 1); top:'+(e.pageY-25)+"px; left:"+(e.pageX+25)+'px">'+i+"</div>"),r&&$("body").append('<div class="tooltip" style="padding: 5px; position: absolute; z-index: 10; background-color: rgba(255, 255, 255, 1); top:'+(e.pageY-25)+"px; left:"+(e.pageX+25)+'px">'+r+"</div>"),o=!0):(i&&$(".tooltip").html(i),r&&$(".tooltip").html(r),$(".tooltip").css("top",e.pageY-25+"px"),$(".tooltip").css("left",e.pageX+25+"px"))}),e.on("featureOut",function(e,t,a,n){o=!1,$(".tooltip").remove()}),layerMap=e,initEventFunctions(e,a),setMapLegendListeners(e,a)})}function removeLayers(e){e.getSubLayers().forEach(function(e){e.remove()})}function initEventFunctions(e,t){$(".change-past-event-layer").click(function(){removeLayers(e),$(this).html("LOOKING FOR UPCOMING EVENTS?"),$(".legend-info-event").html("Past Events"),$(this).removeClass("change-past-event-layer"),$(this).addClass("change-upcoming-event-layer"),e.setInteraction(!0),e.createSubLayer(t.pastevent),initEventFunctions()}),$(".change-upcoming-event-layer").click(function(){removeLayers(e),$(this).html("LOOKING FOR PAST EVENTS?"),$(".legend-info-event").html("Upcoming Events"),$(this).removeClass("change-upcoming-event-layer"),$(this).addClass("change-past-event-layer"),e.setInteraction(!0),e.createSubLayer(t.upcomingevent),initEventFunctions()})}function setMapLegendListeners(e,t){$(".select-legend").click(function(){$(".tooltip").remove();var a=$(this).attr("data-value"),n=$(this).attr("data-layer");removeLayers(e),$(this).hasClass("-selected")===!1&&($(".select-legend").each(function(){$(this).hasClass("-selected")&&($(this).prop("disabled",!1),$(this).toggleClass("-selected"),$("."+a).toggleClass("-open-legend"))}),$(".contain-info").each(function(){$(this).hasClass("-open-legend")&&$(this).toggleClass("-open-legend")}),$(".scroll-contain-legend").hasClass("-scroll")===!1&&$(".scroll-contain-legend").toggleClass("-scroll"),$("."+a).toggleClass("-open-legend"),$(this).toggleClass("-selected"),$(this).prop("disabled",!0),e.setInteraction(!0),e.createSubLayer(t[n]))})}function changeCommitmentLayer(){var e=$(".select-legend-dropdown").val();removeLayers(layerMap),layerMap.setInteraction(!0),layerMap.createSubLayer({sql:"SELECT country, Min(cartodb_id) cartodb_id, Min(theme) theme, count(country), st_centroid(the_geom_webmercator) the_geom_webmercator FROM currentcommitments_countries WHERE country IS NOT NULL AND theme LIKE '%"+e+"%' AND the_geom_webmercator IS NOT NULL AND LENGTH(country) > 0 GROUP BY the_geom_webmercator, country ORDER BY country",cartocss:'#layer::z1 {marker-width: ramp([count], range(25, 45), quantiles(7));marker-fill: #ffa200;marker-fill-opacity: 1;marker-line-width: 1;marker-line-color: #4b392f;marker-line-opacity: 0.1;marker-allow-overlap:true;marker-comp-op: src;[zoom = 2] {marker-width: ramp([count], range(25, 30), quantiles(3));}[zoom = 3] {marker-width: ramp([count], range(30, 35), quantiles(4));}[zoom = 4] {marker-width: ramp([count], range(30, 40), quantiles(5));}[zoom = 5] {marker-width: ramp([count], range(30, 45), quantiles(6));} [zoom = 6] {marker-width: ramp([count], range(35, 45), quantiles(7));}} #layer::z1 {text-name: [count];text-face-name: "DejaVu Sans Book";text-size: 10;text-fill: #FFFFFF;text-label-position-tolerance: 0;text-halo-radius: 0;text-halo-fill: #6F808D;text-dy: 0;text-allow-overlap: true;}',interactivity:"cartodb_id, the_geom_webmercator, country",name:"commitment"})}function showCountriesPage(){!function(e){function t(){e.getJSON("/apiJSON/countries?sort=label",function(t){l=t.data,initMapLayer(s,l,o,n),s.invalidateSize(),showCountriesData(l,r,i),buildCountrySelector(e("#countriesSearch select"),i,l,r),onClickPagination(r,i,l),initCountryTabs(d),e.getJSON("/apiJSON/themes?sort=name&fields=id,label,alias",function(e){c=e.data,appendSelectOptionsFromData(".select-legend-dropdown",c),removeLoader(".l-map",null,!0)})})}function a(){s=initCountriesMap(),e(".select-legend-dropdown").select2({minimumResultsForSearch:1/0,placeholder:"All themes"}),e("#countriesSearch select").select2({containerCssClass:"-tall",placeholder:"Search country..."}),e(".select-legend-dropdown").change(function(){changeCommitmentLayer()})}var n="https://jmonaco.carto.com/api/v2/sql?q=",o={action:{sql:"SELECT * FROM countries_homepage",cartocss:'#layer{polygon-fill:ramp([actionplan],(#c30,#c30,#2d4f00,#66bc29,#2d4f00,#2d4f00,#2d4f00,#66bc29,#2d4f00),("","Inactive","Implementing 1st action plan and Developing 2nd action plan","Developing action plan","Implementing 2nd action plan","Implementing 1st action plan","Developing 1st Action Plan","Implementing action plan"),"=");line-width:1;line-color:#FFF;line-opacity:.5}',interactivity:"the_geom, nid, country, cartodb_id",name:"action"},starred:{sql:"SELECT numberstarred,country, cartodb_id, st_centroid(the_geom_webmercator) the_geom_webmercator FROM starred_commitments WHERE the_geom_webmercator IS NOT NULL ORDER BY numberstarred",cartocss:'#layer::z1 {marker-width: 30;marker-fill: #ffffff;marker-fill-opacity: 1;marker-line-width: 1;marker-line-color: #4b392f;marker-line-opacity: 0.2;marker-allow-overlap:true;marker-comp-op: src;[zoom = 2] {marker-width: 30;}[zoom = 3] {marker-width: 35;}[zoom = 4] {marker-width: 40;}[zoom = 5] {marker-width: 45;}[zoom = 6] {marker-width: 45;}} #layer::z1 {text-name: [numberstarred];text-face-name: "DejaVu Sans Book";text-size: 10;text-fill: #000000;text-label-position-tolerance: 0;text-halo-radius: 0;text-halo-fill: #6F808D;text-dy: 0;text-allow-overlap: true;}',interactivity:"numberstarred, country, cartodb_id, the_geom_webmercator",name:"starred"},people:{sql:"SELECT numberpeopleinvolved,country,countryid, cartodb_id, st_centroid(the_geom_webmercator) the_geom_webmercator FROM people_involved WHERE the_geom_webmercator IS NOT NULL",cartocss:'#layer {marker-width: 50;marker-height: 45;marker-fill: #007acb;marker-fill-opacity: 1;marker-file:url("https://s3.amazonaws.com/com.cartodb.users-assets.production/maki-icons/marker-18.svg");marker-allow-overlap: true;marker-line-width: 1;marker-line-color: #4b392f;marker-line-opacity: 1;marker-comp-op: src-over;[zoom = 2] {marker-width: 30;marker-height: 25;}[zoom = 3] {marker-width: 35;marker-height: 30;}[zoom = 4] {marker-width: 45;marker-height: 40;} [zoom = 5] {marker-width: 50;marker-height: 45;}[zoom = 6] {marker-width: 55;marker-height: 50;}}',interactivity:"numberpeopleinvolved,countryid, country, cartodb_id, the_geom_webmercator",name:"people"},stories:{sql:"SELECT numberstories,country, cartodb_id, st_centroid(the_geom_webmercator) the_geom_webmercator FROM stories WHERE the_geom_webmercator IS NOT NULL",cartocss:'#layer::z1{marker-width: 50;marker-height: 45;marker-fill: #0099ff;marker-fill-opacity: 1;marker-file:url("https://s3.amazonaws.com/com.cartodb.users-assets.production/maki-icons/marker-18.svg");marker-allow-overlap: true;marker-line-width: 1;marker-line-color: #4b392f;marker-line-opacity: 1;marker-comp-op: src-over;[zoom = 2] {marker-width: 50;marker-height: 45;}[zoom = 3] {marker-width: 55;marker-height: 50;}[zoom = 4] {marker-width: 60;marker-height: 55;}[zoom = 5] {marker-width: 65;marker-height: 60;}[zoom = 6] {marker-width: 70;marker-height: 65;}} #layer::z1{text-name: [numberstories];text-face-name: "DejaVu Sans Book";text-size: 10;text-fill: #FFFFFF;text-label-position-tolerance: 0;text-halo-radius: 0;text-halo-fill: #6F808D;text-dy: -0.9;text-allow-overlap: true;text-placement: point;text-placement-type: simple;text-comp-op: screen;}',interactivity:"numberstories, country, cartodb_id, the_geom_webmercator",name:"stories"},upcomingevent:{sql:"SELECT now(), country,countryid, count(country),Min(cartodb_id) cartodb_id, Min(date) date, Min(end_date) end_date, Min(start_date) start_date, Min(title) title, st_centroid(the_geom_webmercator) the_geom_webmercator FROM events_country WHERE title IS NOT NULL AND the_geom_webmercator IS NOT NULL AND end_date > now() GROUP BY  the_geom_webmercator, country, countryid ORDER BY country",cartocss:'#layer::z1 {marker-width: 30;marker-fill: #66bc29;marker-fill-opacity: 1;marker-line-width: 0;marker-line-color: #151718;marker-line-opacity: 0.2;marker-allow-overlap:true;marker-comp-op: src;[zoom = 2] {marker-width: 30;}[zoom = 3] {marker-width: 35;}[zoom = 4] {marker-width: 40;}[zoom = 5] {marker-width: 45;}[zoom = 6] {marker-width: 45;}} #layer::z1 {text-name: [count];text-face-name: "DejaVu Sans Book";text-size: 10;text-fill: #FFFFFF;text-label-position-tolerance: 0;text-halo-radius: 0;text-halo-fill: #6F808D;text-dy: 0;text-allow-overlap: true;}',interactivity:"cartodb_id, the_geom_webmercator",name:"event"},pastevent:{sql:"SELECT now(), country,countryid, count(country),Min(cartodb_id) cartodb_id, Min(date) date, Min(end_date) end_date, Min(start_date) start_date, Min(title) title, st_centroid(the_geom_webmercator) the_geom_webmercator FROM events_country WHERE title IS NOT NULL AND the_geom_webmercator IS NOT NULL AND end_date < now() GROUP BY  the_geom_webmercator, country, countryid ORDER BY country",cartocss:'#layer::z1 {marker-width: 30;marker-fill: #66bc29;marker-fill-opacity: 1;marker-line-width: 0;marker-line-color: #151718;marker-line-opacity: 0.2;marker-allow-overlap:true;marker-comp-op: src;[zoom = 2] {marker-width: 30;}[zoom = 3] {marker-width: 35;}[zoom = 4] {marker-width: 40;}[zoom = 5] {marker-width: 45;}[zoom = 6] {marker-width: 45;}} #layer::z1 {text-name: [count];text-face-name: "DejaVu Sans Book";text-size: 10;text-fill: #FFFFFF;text-label-position-tolerance: 0;text-halo-radius: 0;text-halo-fill: #6F808D;text-dy: 0;text-allow-overlap: true;}',interactivity:"cartodb_id, the_geom_webmercator, country",name:"event"},commitment:{sql:"SELECT country,Min(countryid) countryid, Min(cartodb_id) cartodb_id, count(country), st_centroid(the_geom_webmercator) the_geom_webmercator FROM currentcommitments_countries WHERE country IS NOT NULL AND the_geom_webmercator IS NOT NULL AND LENGTH(country) > 0 GROUP BY the_geom_webmercator, country ORDER BY country DESC",cartocss:'#layer::z1 {marker-width: 30;marker-fill: #ffa200;marker-fill-opacity: 1;marker-line-width: 1;marker-line-color: #4b392f;marker-line-opacity: 0.1;marker-allow-overlap:true;marker-comp-op: src;[zoom = 2] {marker-width: 30;}[zoom = 3] {marker-width: 35;}[zoom = 4] {marker-width: 40;}[zoom = 5] {marker-width:45;} [zoom = 6] {marker-width: 45;}} #layer::z1 {text-name: [count];text-face-name: "DejaVu Sans Book";text-size: 10;text-fill: #FFFFFF;text-label-position-tolerance: 0;text-halo-radius: 0;text-halo-fill: #6F808D;text-dy: 0;text-allow-overlap: true;}',interactivity:"cartodb_id, the_geom_webmercator, country",name:"commitment"},participants:{sql:"SELECT * FROM working_group WHERE show_on_map IS TRUE",cartocss:'#layer {marker-width: 50;marker-height: 45;marker-fill: #FFB927;marker-fill-opacity: 1;marker-file: url("https://s3.amazonaws.com/com.cartodb.users-assets.production/maki-icons/marker-18.svg");marker-allow-overlap: true;marker-line-width: 1;marker-line-color: #4b392f;marker-line-opacity: 1;marker-comp-op: src-over;[zoom = 2] {marker-width: 30;marker-height: 25;}[zoom = 3] {marker-width: 35;marker-height: 30;}[zoom = 4] {marker-width: 45;marker-height: 40;}[zoom = 5] {marker-width: 50;marker-height: 45;}[zoom = 6] {marker-width: 55;marker-height: 50;}}',interactivity:"cartodb_id, title",name:"participants"}},i="#countriesContentContainer",r="starred",s=void 0,l=void 0,c=void 0,d=function(t,a){setPageCount(1),e(".tab-content").addClass("-hidden"),e("."+t).removeClass("-hidden"),showLoader("#countriesContentContainer"),showCountriesData(l,t,i,e("#countriesSearch select").val())};a(),t(),buildMapModal()}(jQuery)}function buildCountrySelector(e,t,a,n){e.append('<option value="0">All countries</option>'),e.append('<svg class="icon -medium -blue"><use xlink:href="#icon-search"></use></svg>'),appendSelectOptionsFromData(e,a),setCountrySelectorListeners(e,t,a,n)}function setCountrySelectorListeners(e,t,a,n){e.on("change",function(){setPageCount(1),showLoader(t);var e=$(this).val();showCountriesData(a,n,t,e)})}function setPageCount(e){$(".page-count").data("value",e)}function getCurrentPage(){var e=$(".page-count").data("value");return e}function onClickPagination(e,t,a){$(".c-pagination-click").on("click",function(){setPageCount(getCurrentPage()+1),showCountriesData(a,e,t)})}function showOnClickPagination(){$(".c-pagination-click").removeClass("-hidden")}function hideOnClickPagination(){$(".c-pagination-click").addClass("-hidden")}function initModalStarred(){$(".show-modal-starred").click(function(){var e=$(this).data("value");$.getJSON("/apiJSON/countries?filter[id]="+e,function(t){showLoader("body"),setMapModalContent("mapModal","starred-tab",e,t)})})}function setCountryDataTiles(e,t){var a=$(".tabs-container").find(".-selected").data("node");if($("#country-"+t.id+" .data-tiles").html(""),"starred"===a)if(t.starred_commitments.length>0){var n=t.starred_commitments.slice(0,2);appendSmallTiles(n,"#country-"+t.id,2,"-short -country"),$("#country-"+t.id+" > .c-country-tile").append('\n        <span data-value="'+t.id+'" class="show-modal-starred text -interactive -blue">Show all starred commitments</span>\n      ')}else showNoResults("#country-"+t.id+" .data-tiles","No starred commitments","medium","grey","xlarge","grey");else"potential"===a?null!==t.year_action_plan?appendCountriesInfoBars(t,"#country-"+t.id):showNoResults("#country-"+t.id+" .data-tiles","No data available","medium","grey","xlarge","grey"):"relevance"===a?t.access_information||t.civic_participation||t.public_accountability||t.unclear?appendCountriesRelevance(t,"#country-"+t.id):showNoResults("#country-"+t.id+" .data-tiles","No data available","medium","grey","xlarge","grey"):"thematic"===a?t.current_themes?appendCountriesThematicBars(t,"#country-"+t.id):showNoResults("#country-"+t.id+" .data-tiles","No data available","medium","grey","xlarge","grey"):showNoResults("#country-"+t.id+" .data-tiles","No data available","medium","grey","large","grey");removeLoader("#countriesContentContainer",null,!0)}function initCountryBox(e,t,a){var n='\n    <div class="column small-12 medium-6" id="country-'+t.id+'">\n      <div class="c-country-tile">\n        <a class="text -title-x-small" href="/'+t.alias+'">'+t.label+'&nbsp;<svg class="icon -blue -medium arrow"><use xlink:href="#icon-arrow"></use></svg></a>\n        <div class="first-info text">\n          <span>Current Commitments '+parseInt(t.current_commitments_count)+"</span>\n          <span>Reviewed Commitments "+parseInt(t.irm_commitments_count)+'</span>\n        </div>\n        <div class="text border-line">\n          <span>Starred Commitments '+parseInt(t.starred_commitments_count)+'</span>\n        </div>\n        <div class="first-info text">\n          <span>Action Plans '+t.action_plan_count+"</span>\n          <span>Member since "+moment.unix(t.memberSince).format("YYYY")+'</span>\n        </div>\n        <div class="row data-tiles"></div>\n      </div>\n    </div>\n  ';$(".content-tiles",e).append(n)}function showCountriesData(e,t,a,n){hideOnClickPagination();var o=getCurrentPage(),i="";if(1===o&&$(".content-tiles",a).html(""),n&&n>0)i=e.filter(function(e){return e.id==n});else{var r=10*(o-1);i=e.slice(r,r+10)}i.forEach(function(e,n){initCountryBox(a,e,t),setCountryDataTiles(a,e)}),o<Math.ceil(e.length/10)&&i.length>1&&showOnClickPagination(),removeLoader(a,null,!0),initModalStarred()}function initCountryTabs(e){initTabs(),setTabListeners(e)}function showAboutPages(){!function(e){function t(e){initTabs(),setTabListeners(e)}var a=e(".tabs-container"),n=e("#containerInfo"),o=function(t,a){e(".tab-content").addClass("-hidden"),e("."+t).removeClass("-hidden")};showLoader("#containerInfo"),e.getJSON("/apiJSON/page?filter[page_category]=2925",function(e){buildTabs(e.data,a,o),t(o);for(var i=0;i<e.data.length;i+=1)n.append('\n        <div class="tab-content -hidden '+e.data[i].id+'">\n          <h3 class="text -section-title">'+e.data[i].label+'</h3>\n          <div class="text -body-content">\n            <p class="text -body-content">\n              '+e.data[i].body.value+"\n            </p>\n          </div>\n        </div>\n      ");removeLoader("#containerInfo",null,!0)})}(jQuery)}function showNewsEventsPage(){!function(e){function t(t){t.image&&e(".c-content-banner").css("background-image","url("+t.image+")"),moment()>moment(t.date.value)?e(".banner-type-date-event").html("Past Event"):e(".banner-type-date-event").html("Upcoming Event"),e(".banner-link",f).attr("href",t.alias),e(".banner-title",f).html(t.label),e(".banner-date",f).html(moment(t.date.value).format("MMMM DD, hh:mm a")),e(".c-content-banner").removeClass("-hidden")}function a(t){e(".page-count").data("value",t)}function n(){var t=e(".page-count").data("value");return t}function o(){e(".page-count").on("click",function(){a(n()+1),h=n(),p>n()&&(showLoader("#eventsContainer"),s(c,d,n()))})}function i(t,a,n,o){t.select2({minimumResultsForSearch:1/0,containerCssClass:"-green -tall",dropdownCssClass:"-green",placeholder:""+a}),t.append('<option value="0">'+a+"</option>"),e.getJSON("/apiJSON/"+n+"?"+o,function(e){e.data.forEach(function(e){var a='<option value="'+e.id+'">'+e.label+"</option>";t.append(a)}),t.on("change",function(){showLoader("#eventsContainer"),c=v.val(),d=g.val(),u=1,s(c,d,u)})})}function r(){c=v.val(),d=g.val(),e(".onClickPagination").on("click",function(t){showLoader("#newsContainer");var a=e(this).data("value");l(c,d,a)})}function s(a,n,o){var i=parseInt(a)>0?"filter[country]="+a+"&":"",r=parseInt(n)>0?"filter[category]="+n+"&":"",s=""+i+r+"&page="+o;e.getJSON("/apiJSON/events?"+s+"&sort=-date",function(a){p=getPageCount(a.count,4),a.data.length>0?1===h?e.getJSON("/apiJSON/events?sort=-date",function(e){t(e.data[0]),appendTilesEvent(a.data,b),removeLoader("#eventsContainer",null,!0)}):(appendTilesEvent(a.data,b),removeLoader("#eventsContainer",null,!0)):(showNoResults("#eventsContainer","No events with these filters","tall","grey","xxlarge","blue"),removeLoader("#eventsContainer",null,!0))})}function l(a,n,o){var i=parseInt(a)>0?"filter[country]="+a+"&":"",s=parseInt(n)>0?"filter[category]="+n+"&":"",l=""+i+s+"&page="+o;e.getJSON("/apiJSON/news?"+l+"&sort=-date",function(a){a.data.length>0?(m=getPageCount(a.count,4),1===o?e.getJSON("/apiJSON/news?sort=-date",function(e){t(e.data[0]),appendTilesDetailedNews(a.data,w,2),initPagination(o,m,"newsEventsPage"),r(),removeLoader("#newsContainer",null,!0)}):(appendTilesDetailedNews(a.data,w,2),removeLoader("#newsContainer",null,!0),initPagination(o,m,"newsEventsPage"),r())):(showNoResults("#newsTiles","No news with these filters","tall","grey","xxlarge","blue"),e(".c-pagination").html(""),removeLoader("#newsContainer",null,!0))})}var c=0,d=0,u=1,m=0,p=0,h=1,v=e(".country-filter"),g=e(".type-filter"),f=e(".c-content-banner"),b=e("#eventsTiles"),w=e("#newsTiles");i(v,"All countries","countries","fields=id,label&sort=label"),i(g,"All story types","stories_categories","fields=id,label&sort=label"),s(c,d,u),l(c,d,u),o()}(jQuery)}function showHomePage(){!function(e){var t=L.map("maphome",{zoomControl:!1,center:[35,-60],zoom:2,maxZoom:6,minZoom:2,scrollWheelZoom:!1}),a=!1;e("#in").click(function(){t.setZoom(t.getZoom()+1)}),e("#out").click(function(){t.setZoom(t.getZoom()-1)});L.tileLayer("http://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png",{attribution:""}).addTo(t);cartodb.createLayer(t,{user_name:"jmonaco",type:"cartodb",sublayers:[{sql:"SELECT * FROM countries_homepage",cartocss:'#layer{polygon-fill:ramp([actionplan],(#c30,#c30,#2d4f00,#66bc29,#2d4f00,#2d4f00,#2d4f00,#66bc29,#2d4f00),("","Inactive","Implementing 1st action plan and Developing 2nd action plan","Developing action plan","Implementing 2nd action plan","Implementing 1st action plan","Developing 1st Action Plan","Implementing action plan"),"=");line-width:1;line-color:#FFF;line-opacity:.5}',interactivity:"the_geom, nid, country, cartodb_id"}]}).addTo(t).done(function(n){n.setInteraction(!0);var o=[];n.on("featureClick",function(t,a,n,o){e.getJSON("https://jmonaco.carto.com/api/v2/sql?q= SELECT * FROM countries_homepage WHERE cartodb_id =  "+o.cartodb_id,function(e){document.location.href=""+window.location.origin+e.rows[0].path})}),n.bind("featureOver",function(t,a,n,i,r){o[r]=1,_.any(o)&&e("#maphome").css("cursor","pointer")}),n.bind("featureOut",function(t,a){o[a]=0,_.any(o)||e("#maphome").css("cursor","auto")}),n.on("featureOver",function(t,n,o,i){a===!1?(e("body").append('<div class="tooltip" style="padding: 5px; position: absolute; z-index: 10; background-color: rgba(255, 255, 255, 1); top:'+(t.pageY-25)+"px; left:"+(t.pageX+25)+'px">'+i.country+"</div>"),a=!0):(e(".tooltip").html(i.country),e(".tooltip").css("top",t.pageY-25+"px"),e(".tooltip").css("left",t.pageX+25+"px"))}),n.on("featureOut",function(t,n,o,i){a=!1,e(".tooltip").remove()}),t.invalidateSize()})}(jQuery)}function showSliderHomePage(){!function(e){e.getJSON("/apiJSON/stories?fields=label,alias,image&sort=-created&range=3",function(t){showLoader(".slider-cover-home");for(var a=0;a<3;a+=1)e(".slider-cover-home").append('\n          <div class="c-slider-home-page slider-image-0 '+(t.data[a].image?"-image":"")+'">\n            <div class="row">\n              <div class="column small-12 medium-9">\n                <div class="container slider-0">\n                  <div>\n                    <h1 class="title-text -white">\n                      <a href="'+t.data[a].alias+'">'+t.data[a].label+'</a>\n                    </h1>\n                    <div class="small-12 medium-5 large-4">\n                      <a class="c-button -box" href="'+t.data[a].alias+'">Explore the story</a>\n                    <div>\n                  </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n        '),t.data[a].image&&e(".slider-image-"+a).css("background-image","url("+t.data[a].image+")");removeLoader(".slider-cover-home"),e(".slider-cover-home").slick({dots:!0,arrows:!1,speed:500,fade:!0,cssEase:"linear",dotsClass:"dots-slider",adaptiveHeight:!0})})}(jQuery)}function showDocumentResourcePage(){!function(e){var t=e("#resourceDocsTiles"),a=e(".c-tile"),n=e(".c-tile .tile"),o=e("#resourceTilesSearch input");e.getJSON("/apiJSON/resource",function(e){setSearchPlaceholder(o,e.data[0].label),setSearchListeners(a,n),e.data.length?appendTiles(e.data,t,4):showNoResults()})}(jQuery)}function showIrmReports(){!function(e){function t(e){initTabs(),setTabListeners(e)}function a(t){e(".reload-thematic-download").data("value",t)}function n(t){e(".reload-thematic-comments").data("value",t)}function o(){var t=e(".reload-thematic-download").data("value");return t}function i(){var t=e(".reload-thematic-comments").data("value");return t}function r(){e(".c-pagination-click-download").on("click",function(){a(o()+1),showLoader("#container-info"),l(u,o())})}function s(){e(".c-pagination-click-comments").on("click",function(){n(i()+1),showLoader("#container-info"),showTilesComments(u,i())})}function l(t,a){var n=parseInt(t)>0?"filter[id]="+t+"&":"";
e.getJSON("/apiJSON/countries?"+n+"sort=label",function(e){appendTilesIRM(e.data,v),appendTilesComments(e.data,g),removeLoader("#container-info",null,!0)})}function c(t,a,n,o){t.select2({minimumResultsForSearch:1/0,containerCssClass:"-green -tall",dropdownCssClass:"-green",placeholder:""+a}),t.append('<option value="0">'+a+"</option>"),e.getJSON("/apiJSON/"+n+"?"+o,function(a){a.data.forEach(function(e){var a='<option value="'+e.id+'">'+e.label+"</option>";t.append(a)}),e(p).on("change",function(){e(v).html(""),showLoader("#tab-loader"),u=p.val(),m=1,l(u,m)})})}function d(t,a,n,o){t.select2({minimumResultsForSearch:1/0,containerCssClass:"-green -tall",dropdownCssClass:"-green",placeholder:""+a}),t.append('<option value="0">'+a+"</option>"),e.getJSON("/apiJSON/"+n+"?"+o,function(a){a.data.forEach(function(e){var a='<option value="'+e.id+'">'+e.label+"</option>";t.append(a)}),e(h).on("change",function(){e(v).html(""),showLoader("#tab-loader-comments"),u=h.val(),m=1,showTilesComments(u,m)})})}var u=0,m=1,p=e(".country-filter-download"),h=e(".country-filter-comments"),v=(e(".tabs-container"),e("#container-info"),e("#downloadContainer")),g=e("#commentsContainer"),f=function(t,a){e(".tab-content").addClass("-hidden"),e("."+t).removeClass("-hidden")};c(p,"All countries","countries","fields=id,label&sort=label"),d(h,"All countries","countries","fields=id,label&sort=label"),r(),s(),t(f),l(u,m)}(jQuery)}function showNewsEventsPage(){!function(e){function t(t){t.image&&e(".c-content-banner").css("background-image","url("+t.image+")"),moment()>moment(t.date.value)?e(".banner-type-date-event").html("Past Event"):e(".banner-type-date-event").html("Upcoming Event"),e(".banner-link",f).attr("href",t.alias),e(".banner-title",f).html(t.label),e(".banner-date",f).html(moment(t.date.value).format("MMMM DD, hh:mm a")),e(".c-content-banner").removeClass("-hidden")}function a(t){e(".page-count").data("value",t)}function n(){var t=e(".page-count").data("value");return t}function o(){e(".page-count").on("click",function(){a(n()+1),h=n(),p>n()&&(showLoader("#eventsContainer"),s(c,d,n()))})}function i(t,a,n,o){t.select2({minimumResultsForSearch:1/0,containerCssClass:"-green -tall",dropdownCssClass:"-green",placeholder:""+a}),t.append('<option value="0">'+a+"</option>"),e.getJSON("/apiJSON/"+n+"?"+o,function(e){e.data.forEach(function(e){var a='<option value="'+e.id+'">'+e.label+"</option>";t.append(a)}),t.on("change",function(){showLoader("#eventsContainer"),c=v.val(),d=g.val(),u=1,s(c,d,u)})})}function r(){c=v.val(),d=g.val(),e(".onClickPagination").on("click",function(t){showLoader("#newsContainer");var a=e(this).data("value");l(c,d,a)})}function s(a,n,o){var i=parseInt(a)>0?"filter[country]="+a+"&":"",r=parseInt(n)>0?"filter[category]="+n+"&":"",s=""+i+r+"&page="+o;e.getJSON("/apiJSON/events?"+s+"&sort=-date",function(a){p=getPageCount(a.count,4),a.data.length>0?1===h?e.getJSON("/apiJSON/events?sort=-date",function(e){t(e.data[0]),appendTilesEvent(a.data,b),removeLoader("#eventsContainer",null,!0)}):(appendTilesEvent(a.data,b),removeLoader("#eventsContainer",null,!0)):(showNoResults("#eventsContainer","No events with these filters","tall","grey","xxlarge","blue"),removeLoader("#eventsContainer",null,!0))})}function l(a,n,o){var i=parseInt(a)>0?"filter[country]="+a+"&":"",s=parseInt(n)>0?"filter[category]="+n+"&":"",l=""+i+s+"&page="+o;e.getJSON("/apiJSON/news?"+l+"&sort=-date",function(a){a.data.length>0?(m=getPageCount(a.count,4),1===o?e.getJSON("/apiJSON/news?sort=-date",function(e){t(e.data[0]),appendTilesDetailedNews(a.data,w,2),initPagination(o,m,"newsEventsPage"),r(),removeLoader("#newsContainer",null,!0)}):(appendTilesDetailedNews(a.data,w,2),removeLoader("#newsContainer",null,!0),initPagination(o,m,"newsEventsPage"),r())):(showNoResults("#newsTiles","No news with these filters","tall","grey","xxlarge","blue"),e(".c-pagination").html(""),removeLoader("#newsContainer",null,!0))})}var c=0,d=0,u=1,m=0,p=0,h=1,v=e(".country-filter"),g=e(".type-filter"),f=e(".c-content-banner"),b=e("#eventsTiles"),w=e("#newsTiles");i(v,"All countries","countries","fields=id,label&sort=label"),i(g,"All story types","stories_categories","fields=id,label&sort=label"),s(c,d,u),l(c,d,u),o()}(jQuery)}function loginPage(){!function(e){e("#edit-name").attr("placeholder","Enter your Open Government Partnership username"),e("#edit-pass").attr("placeholder","Enter the password that accompanies your username.")}(jQuery)}function showGroupResourcesDetail(e){!function(e){var t=e("#groupResourcesDetail").data("node"),a=e("#groupResourcesTabs .tabs-container"),n=e("#resourceTilesSearch input"),o=e("#tilesContainer"),i=e(".c-tile"),r=e(".c-tile .tile"),s=function(a,i){hideNoResults("#noResultsContainer"),showLoader(".l-section"),o.html(""),n.val("");var r=2920===t?"":"filter[group_resource]="+t+"&";e.getJSON("/apiJSON/resources?"+r+"filter[sub_group]="+a+"&sort=-post_highlighted",function(e){e.data.length?appendTiles(e.data,o,4):showNoResults("#noResultsContainer","No resources available","tall","grey","xxlarge","blue"),removeLoader(".l-section",null,!0)}),setSearchPlaceholder(n,i)};e.getJSON("/apiJSON/sub_group_resource",function(l){buildTabs(l.data,a,s),setSearchPlaceholder(n,l.data[0].label),setSearchListeners(i,r);var c=2920===t?"":"filter[group_resource]="+t+"&";e.getJSON("/apiJSON/resources?"+c+"filter[sub_group]="+l.data[0].id+"&sort=-post_highlighted",function(e){e.data.length?appendTiles(e.data,o,4):showNoResults("#noResultsContainer","No resources available","tall","grey","xxlarge","blue"),removeLoader(".l-section",null,!0)})})}(jQuery)}function showGroupResourcesPage(){!function(e){var t=e("#groupResourcesTiles");e.getJSON("/apiJSON/group_resources",function(e){e.data.forEach(function(e){var a='\n          <div class="column small-12 medium-4 c-tile">\n            <a href="/'+e.alias+'" class="tile -tall">\n              <span class="text -tile -white">\n                '+e.label+"\n              </span>\n            </a>\n          </div>\n        ";t.append(a)}),removeLoader(".l-section",null,!0)})}(jQuery)}function showResourcesDetail(e){!function(t){t.getJSON("/apiJSON/resources?filter[id]="+e,function(e){buildExploreMoreTiles("resources","group_resource",e.data[0].group_resource[0])})}(jQuery)}function showStoryDetail(e){!function(t){t.getJSON("/apiJSON/stories/"+e,function(e){var a=e.data[0],n=moment.unix(parseInt(a.created)).format("D MMMM YYYY"),o="",i='<strong class="text">Authors: </strong>';if(a.country.length){var r=a.country;r.forEach(function(e,t){var a=""+e.alias;o+=t===r.length-1?'<a href="/'+a+'">'+e.label+'</a><span class="text -post-meta"> | </span>':'<a href="/'+a+'">'+e.label+", </a>"})}o+='<span class="text -post-meta">'+n+"</span>",t(".countries").html(o),a.content&&t(".-body-content").html(a.content.value),a.author[0]&&(a.author.forEach(function(e,t){i+=t===a.author.length-1?'<a class="text" href="/'+e.alias+'">'+e.label+"</a>":'<a class="text" href="/'+e.alias+'">'+e.label+", </a>"}),t(".author").append(i)),a.topic[0]&&(t(".topic").append('<strong class="text">Topics: </strong>'),a.topic.forEach(function(e,n){var o=""+e.alias;n===a.topic.length-1?t(".topic").append('<a class="text" href="/'+o+'">'+e.label+"</a>"):t(".topic").append('<a class="text" href="/'+o+'">'+e.label+"</a>, ")})),a.tags&&(t(".tags").append('<strong class="text -bold">Tags: </strong>'),a.tags.forEach(function(e,n){n===a.tags.length-1?t(".tags").append('<span class="text">'+e.label+"</span>"):t(".tags").append('<span class="text">'+e.label+"</span>, ")})),a.type&&(t(".filed-under").append('<strong class="text -bold">Filed Under: </strong>'),t(".filed-under").append('<span class="text">'+a.type.label+"</a>")),removeLoader("#storiesDetail")})}(jQuery)}function showStoriesPage(){!function(e){function t(t,a,s,d){t.select2({minimumResultsForSearch:1/0,containerCssClass:"-green -tall",dropdownCssClass:"-green",placeholder:""+a}),t.append('<option value="0">'+a+"</option>"),e.getJSON("/apiJSON/"+s+"?"+d,function(e){e.data.forEach(function(e){var a='<option value="'+e.id+'">'+e.label+"</option>";t.append(a)}),t.on("change",function(){showLoader("#storiesContainer"),o=l.val(),i=c.val(),r=1,n(o,i,r)})})}function a(){o=l.val(),i=c.val(),e(".onClickPagination").on("click",function(t){showLoader("#storiesContainer");var a=e(this).data("value");n(o,i,a)})}function n(t,n,o){var i=parseInt(t)>0?"filter[country]="+t+"&":"",r=parseInt(n)>0?"filter[category]="+n+"&":"",l=""+i+r+"&page[number]="+o+"&page[size]=8";e.getJSON("/apiJSON/stories?"+l+"&sort=-created",function(t){t.data.length>0?(s=getPageCount(t.count,8),appendTilesDetailed(t.data,d,2),removeLoader("#storiesContainer",null,!0),initPagination(o,s,"storiesPage"),a()):(showNoResults("#storiesTiles","No stories with these filters","tall","grey","xxlarge","blue"),e(".c-pagination").html(""),removeLoader("#storiesContainer",null,!0))}).error(function(){showNoResults("#storiesTiles","Sorry, stories counld not be found","tall","grey","xxlarge","blue"),e(".c-pagination").html(""),removeLoader("#storiesContainer",null,!0)})}var o=0,i=0,r=1,s=0,l=e(".country-filter"),c=e(".type-filter"),d=(e(".c-content-banner"),e("#storiesTiles"));t(l,"All countries","countries","fields=id,label&sort=label"),t(c,"All story types","stories_categories","fields=id,label&sort=label"),n(o,i,r)}(jQuery)}function showStoriesSubmitPage(e){!function(e){var t=".type-select",a=".country-select";e("#stories-menu").addClass("active"),e(t).select2({minimumResultsForSearch:1/0,containerCssClass:"-tall",placeholder:"All story types"}),e(a).select2({minimumResultsForSearch:1/0,containerCssClass:"-tall",placeholder:"All countries"}),e.getJSON("/apiJSON/countries?fields=id,name,label&sort=label",function(n){appendSelectOptionsFromData(a,n.data),e.getJSON("/apiJSON/themes?sort=label&fields=id,label",function(e){appendSelectOptionsFromData(t,e.data),removeLoader(".c-form",null,!0)})}),e(".js-submit-story").click(function(){e(".-title").val(),e(".country-select").val(),e(".type-select").val(),e(".-date").val(),e(".-image").val(),e(".-content").val(),e(".-email").val(),e(".-author").val();e.ajax({url:"/sites/all/themes/custom/ogp_theme/phpFunctions/createNode.php",type:"POST",dataType:"json",data:{}}).done(function(e){})})}(jQuery)}function showThemesDetail(e){!function(t){function a(e,t,a){var n="\n        <b>Contributors:</b> This topic has been developed for the Open Gov Guide by the National Democratic Institute. The lead author was Patrick Merloe with contributions from Michelle Brown and Tova Wang. Please send comments to pat@ndi.org.\n      ";l.html(n)}function n(){r.on("change",function(){hideNoResults(),showLoader("#themesDetail");var e=t(".c-tabs .-selected").data("node"),a=t(this).val();0===parseInt(a)?i(s,e):i(s,e,a)})}function o(){r.select2({minimumResultsForSearch:1/0,containerCssClass:"-green -tall",dropdownCssClass:"-green",placeholder:"All countries"}),t(".select2").addClass("-green-select"),t.getJSON("/apiJSON/countries?fields=id,label&sort=label",function(e){e.data.forEach(function(e){var t='<option value="'+e.id+'">'+e.label+"</option>";r.append(t)})}),n()}function i(a,n,o){a.html("");var i=o&&"modelcommitments"!==n?"&filter[country]="+o:"",r="stories"===n?"-created":"label";t.getJSON("/apiJSON/"+n+"?filter[theme]="+e+i+"&sort="+r,function(e){hideNoResults(),e.data.length?appendTilesWithoutBackground(e.data,a,2,"-themes"):showNoResults(a,"No content available","tall","grey","xxlarge","blue"),removeLoader("#themesDetail",null,!0)})}var r=t(".country-selector"),s=t("#contentContainer .content-tiles"),l=t("#contributorsText"),c=function(e,n){hideNoResults(),showLoader("#themesDetail"),t("#themesDetail .-body-content").addClass("-hidden"),t("#themesDetail ."+e).removeClass("-hidden");var o=r.val();0===parseInt(o)?i(s,e):i(s,e,o),a(),"modelcommitments"===e?l.removeClass("-hidden"):l.addClass("-hidden")};initTabs(),setTabListeners(c),o(),i(s,"starredcommitments"),buildExploreMoreTiles("themes")}(jQuery)}function showThemesPage(){!function(e){function t(){e.getJSON("/apiJSON/themes?sort=label",function(e){e.data.length?appendTiles(e.data,a,3):showNoResults("#tilesNoResults","No themes available","tall","grey","xxlarge","blue"),removeLoader(".l-section",null,!0)})}var a=e("#tilesContainer"),n=e("#themesTilesSearch input"),o=e(".c-tile"),i=e(".c-tile .tile"),r=e(".tiles-heading"),s=function(t,a){r.html(a);var o=n.val();o=o.toLowerCase();var i=parseInt(t);e(".c-tile").each(function(){o?e(this).data("group")===i&&e(this).html().toLowerCase().indexOf(o)>-1||"0"===t&&e(".tile",this).html().toLowerCase().indexOf(o)>-1?e(this).css("display","block"):e(this).css("display","none"):e(this).data("group")===i||0===i?e(this).css("display","block"):e(this).css("display","none")});var s=e(".c-tile").filter(function(){return"block"===e(this).css("display")}).length;0===s?showNoResults("#noResultsContainer","No themes available","tall","grey","xxlarge","blue"):hideNoResults("#noResultsContainer")};t(),initTabs(),setTabListeners(s),setSearchListeners(o,i)}(jQuery)}function showGroupList(){!function(e){function t(){e(".onClickPagination").on("click",function(t){showLoader("#tableContainer");var n=e(this).data("value");a(n,i)})}function a(a,n){var i="";i="asc"===n?"sort=label":"sort-=label",e.getJSON("/apiJSON/working_group?&page="+a+"&"+i,function(n){o=getPageCount(n.count,5),1===a?e.getJSON("/apiJSON/working_group?date&page="+a+"&"+i,function(e){createTable(e,"groups"),initPagination(a,o,"workingGroupList"),t(),removeLoader("#tableContainer",null,!0)}):(createTable(n,"groups"),removeLoader("#tableContainer",null,!0),initPagination(a,o,"workingGroupList"),t())})}var n=1,o=0,i="asc";e(".container-info-table");e(".sort-field").click(function(){"asc"===i?(e(".triangle-sort").css("transform","rotate(180deg)"),i="desc"):(e(".triangle-sort").css("transform","rotate(0deg)"),i="asc"),n=1,showLoader("#tableContainer"),a(n,i)}),a(n,i)}(jQuery)}function showWorkingGroupDetail(e){!function(t){function a(e){initTabs(),setTabListeners(e)}var n=t(".tabs-container"),o=t("#container-info"),i=function(e,a){t(".tab-content").addClass("-hidden"),t("."+e).removeClass("-hidden")};showLoader(".working-group-content"),t.getJSON("/apiJSON/working_group_page?filter[working_group]="+e,function(e){buildTabs(e.data,n,i),a(i);for(var t=0;t<e.data.length;t+=1)o.append('\n          <div class="tab-content -hidden '+e.data[t].id+'">\n            <h3 class="text -section-title">'+e.data[t].label+'</h3>\n            <div class="text -body-content">\n              <p class="text -body-content">\n                '+e.data[t].body.value+"\n              </p>\n            </div>\n          </div>\n        ");removeLoader(".working-group-content",null,!0)})}(jQuery)}function showPageList(){!function(e){function t(){e(".onClickPagination").on("click",function(t){showLoader("#tableContainer");var n=e(this).data("value");a(n,i)})}function a(a,i){var r="";r="asc"===i?"sort=label":"sort-=label",e.getJSON("/apiJSON/page?&page="+a+"&"+r,function(i){o=getPageCount(i.count,5),1===n?e.getJSON("/apiJSON/page?date&page="+a+"&"+r,function(e){createTable(e,"pages"),initPagination(a,o,"pagesList"),t(),removeLoader("#tableContainer",null,!0)}):(createTable(i,"pages"),removeLoader("#tableContainer",null,!0),initPagination(a,o,"pagesList"),t())})}var n=1,o=0,i="asc";e(".sort-field").click(function(){"asc"===i?(e(".triangle-sort").css("transform","rotate(180deg)"),i="desc"):(e(".triangle-sort").css("transform","rotate(0deg)"),i="asc"),n=1,showLoader("#tableContainer"),a(n,i)}),a(n,i)}(jQuery)}function featuresResultPage(){!function(e){e("#value-search").html("Search for: "+e("#edit-keys").val())}(jQuery)}function searchPage(){!function(e){e(".search-form input").attr("placeholder","Type what you are searching for...")}(jQuery)}!function(e){Drupal.behaviors.myBehavior={attach:function(t,a){a.block_refresh.args[0];window.liveSettings={api_key:"5a2bcd52efad4b169c9543330d3187a4",picker:"#transifexSelector"},smoothScroll(),window.liveSettings.picker="#transifexSelector",0!==e(t).find("#homePage").length&&(showHomePage(),showSliderHomePage(),addBanner("involved")),0!==e(t).find("#storiesPage").length&&(showStoriesPage(),addBanner("writestory"),addBanner("newsletter")),0!==e(t).find("#storiesSubmitPage").length&&(addBanner("newsletter"),showStoriesSubmitPage(a.block_refresh.args[2])),0!==e(t).find("#storiesDetail").length&&(addBanner("writestory"),addBanner("newsletter"),showStoryDetail(a.block_refresh.args[1]),stripEmptyStrings()),0!==e(t).find("#countriesDetail").length&&(addBanner("peopleCountry",a.block_refresh.args[1]),addBanner("newsletter"),showCountriesDetail(a.block_refresh.args[1])),0!==e(t).find("#countriesPage").length&&(addBanner("newsletter"),showCountriesPage()),0!==e(t).find("#themesPage").length&&(addBanner("newsletter"),showThemesPage()),0!==e(t).find("#themesDetail").length&&(addBanner("newsletter"),showThemesDetail(a.block_refresh.args[2])),0!==e(t).find("#groupResourcesPage").length&&(addBanner("newsletter"),showGroupResourcesPage()),0!==e(t).find("#groupResourcesDetail").length&&(addBanner("newsletter"),showGroupResourcesDetail(a.block_refresh.args[1])),0!==e(t).find("#resourcesDetail").length&&(addBanner("newsletter"),showResourcesDetail(a.block_refresh.args[1])),0!==e(t).find("#documentResourcesPage").length&&(addBanner("newsletter"),showDocumentResourcePage(),stripEmptyStrings()),0!==e(t).find("#documentResourcesDetail").length&&(addBanner("newsletter"),stripEmptyStrings()),0!==e(t).find("#modelCommitmentsDetail").length&&(addBanner("newsletter"),showModelCommitmentDetail(a.block_refresh.args[1])),0!==e(t).find("#starredCommitmentsDetail").length&&(addBanner("newsletter"),showStarredCommitmentDetail(a.block_refresh.args[1])),0!==e(t).find("#currentCommitmentsDetail").length&&(addBanner("newsletter"),showCurrentCommitmentDetail(a.block_refresh.args[1])),0!==e(t).find("#irmCommitmentsDetail").length&&(addBanner("newsletter"),showIrmCommitmentDetail(a.block_refresh.args[1])),0!==e(t).find("#peopleInvolved").length&&addBanner("newsletter"),0!==e(t).find("#newsEventsPage").length&&(showNewsEventsPage(),addBanner("writestory"),addBanner("newsletter")),0!==e(t).find("#newsTemplate").length&&(addBanner("writestory"),addBanner("newsletter")),0!==e(t).find("#eventsTemplate").length&&(addBanner("writestory"),addBanner("newsletter")),0!==e(t).find("#workingGroupList").length&&(showGroupList(),addBanner("newsletter")),0!==e(t).find("#workingGroupDetail").length&&(showWorkingGroupDetail(a.block_refresh.args[1]),addBanner("newsletter")),0!==e(t).find("#pagesList").length&&(showPageList(),addBanner("newsletter")),0!==e(t).find("#irmReportsPage").length&&(showIrmReports(),addBanner("newsletter")),0!==e(t).find("#loginPage").length&&addBanner("newsletter"),0!==e(t).find("#aboutPage").length&&(showAboutPages("newsletter"),addBanner("newsletter")),0!==e(t).find("#searchPage").length&&(searchPage(),addBanner("newsletter")),0!==e(t).find("#resultSearchPage").length&&featuresResultPage(),0!==e(t).find("#page404").length&&addBanner("newsletter"),0!==e(t).find("#node").length&&addBanner("newsletter"),buildSubscribeModal(),0!==e(t).find("#disqus_thread").length&&showComments(a.block_refresh.args[1]),0!==e(t).find("#aboutMenu").length&&aboutMenu(),e(".form-select").select2({minimumResultsForSearch:1/0,containerCssClass:"-tall"}),0!==e(t).find("#loginPage").length&&loginPage()}}}(jQuery);var layerMap="";